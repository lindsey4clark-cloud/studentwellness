<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Wellness Evaluation Task Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getDatabase, ref, set, push, onValue, remove, update, off } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBNGWGQMRSHr-2-i2YN6R12Uj4XhbKBolI",
            authDomain: "wellness-student.firebaseapp.com",
            databaseURL: "https://wellness-student-default-rtdb.firebaseio.com",
            projectId: "wellness-student",
            storageBucket: "wellness-student.firebasestorage.app",
            messagingSenderId: "63000652168",
            appId: "1:63000652168:web:adceba5425f5acb4a7f23d",
            measurementId: "G-KDY4D8TPR5"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        window.firebaseDB = database;
        window.firebaseRef = ref;
        window.firebaseSet = set;
        window.firebasePush = push;
        window.firebaseOnValue = onValue;
        window.firebaseRemove = remove;
        window.firebaseUpdate = update;
        window.firebaseOff = off;

        // Global state management
        window.appState = {
            tasks: [],
            listeners: [],
            isEditing: false
        };

        window.addEventListener('DOMContentLoaded', () => {
            loadTasks();
        });

        function loadTasks() {
            const tasksRef = window.firebaseRef(window.firebaseDB, 'tasks');
            window.firebaseOnValue(tasksRef, (snapshot) => {
                if (!window.appState.isEditing) {
                    const data = snapshot.val();
                    if (data) {
                        window.appState.tasks = Object.keys(data).map(key => ({ id: key, ...data[key] }));
                    } else {
                        window.appState.tasks = [];
                    }
                    renderApp();
                }
            });
        }

        function renderApp() {
            const root = document.getElementById('root');
            root.innerHTML = generateHTML();
            attachEventListeners();
        }

        function generateHTML() {
            const phases = ['Planning & Design', 'Data Collection', 'Analysis', 'Reporting & Dissemination', 'Stakeholder Engagement'];
            const tasks = window.appState.tasks;
            
            const getProgressByPhase = (phase) => {
                const phaseTasks = tasks.filter(task => task.phase === phase);
                return phaseTasks.length === 0 ? 0 : Math.round((phaseTasks.filter(t => t.status === 'Completed').length / phaseTasks.length) * 100);
            };

            const getOverallProgress = () => {
                return tasks.length === 0 ? 0 : Math.round((tasks.filter(t => t.status === 'Completed').length / tasks.length) * 100);
            };

            const filter = window.appState.statusFilter || 'all';
            const phaseFilter = window.appState.phaseFilter || 'all';
            const assigneeFilter = window.appState.assigneeFilter || 'all';

            const filteredTasks = tasks.filter(task => {
                return (filter === 'all' || task.status === filter) && 
                       (phaseFilter === 'all' || task.phase === phaseFilter) && 
                       (assigneeFilter === 'all' || task.assignedTo === assigneeFilter);
            });

            return `
                <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 p-6">
                    <div class="max-w-7xl mx-auto">
                        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <h1 class="text-3xl font-bold text-gray-800 mb-2">Student Wellness Program Evaluation</h1>
                            <p class="text-gray-600 mb-4">Task Manager - Team Collaboration Enabled ðŸ”¥</p>
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="font-semibold text-gray-700">Overall Progress</span>
                                    <span class="text-2xl font-bold text-blue-600">${getOverallProgress()}%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-4">
                                    <div class="bg-blue-600 h-4 rounded-full transition-all duration-300" style="width: ${getOverallProgress()}%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-5 gap-3 mb-6">
                            ${phases.map(phase => `
                                <div class="bg-white p-4 rounded-lg shadow">
                                    <h3 class="font-semibold text-sm mb-2 text-gray-700">${phase}</h3>
                                    <div class="text-2xl font-bold text-indigo-600 mb-1">${getProgressByPhase(phase)}%</div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-indigo-600 h-2 rounded-full transition-all duration-300" style="width: ${getProgressByPhase(phase)}%"></div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>

                        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <div class="flex gap-4 items-center mb-4">
                                <button id="addTaskBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line>
                                    </svg>
                                    Add New Task
                                </button>
                                <div class="flex gap-2 flex-1">
                                    <select id="statusFilter" class="p-2 border rounded">
                                        <option value="all">All Statuses</option>
                                        <option value="Not Started">Not Started</option>
                                        <option value="In Progress">In Progress</option>
                                        <option value="Completed">Completed</option>
                                    </select>
                                    <select id="phaseFilterSelect" class="p-2 border rounded">
                                        <option value="all">All Phases</option>
                                        ${phases.map(phase => `<option value="${phase}">${phase}</option>`).join('')}
                                    </select>
                                    <select id="assigneeFilter" class="p-2 border rounded">
                                        <option value="all">All Team Members</option>
                                        <option value="Alexa">Alexa</option>
                                        <option value="Dillon">Dillon</option>
                                        <option value="Lindsey">Lindsey</option>
                                        <option value="Carson">Carson</option>
                                        <option value="Kyle">Kyle</option>
                                        <option value="StudentWellness Team">StudentWellness Team</option>
                                    </select>
                                </div>
                                <div class="text-sm text-gray-600">Showing ${filteredTasks.length} of ${tasks.length} tasks</div>
                            </div>
                            <div id="addTaskForm"></div>
                        </div>

                        <div id="tasksList" class="space-y-4">
                            ${filteredTasks.length === 0 ? `
                                <div class="bg-white rounded-lg shadow p-8 text-center text-gray-500">
                                    <p>No tasks found. Click "Add New Task" to get started!</p>
                                </div>
                            ` : filteredTasks.map(task => `
                                <div class="bg-white rounded-lg shadow-md p-6" data-task-id="${task.id}">
                                    ${window.appState.editingTaskId === task.id ? generateEditForm(task) : generateTaskView(task)}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function generateTaskView(task) {
            const getPriorityColor = (priority) => {
                const colors = { 'High': 'text-red-600 bg-red-50 border-red-200', 'Medium': 'text-yellow-600 bg-yellow-50 border-yellow-200', 'Low': 'text-green-600 bg-green-50 border-green-200' };
                return colors[priority] || 'text-gray-600 bg-gray-50 border-gray-200';
            };

            const getStatusColor = (status) => {
                const colors = { 'Completed': 'text-green-700 bg-green-100', 'In Progress': 'text-blue-700 bg-blue-100', 'Not Started': 'text-gray-700 bg-gray-100' };
                return colors[status] || 'text-gray-700 bg-gray-100';
            };

            return `
                <div class="flex items-start justify-between mb-3">
                    <div class="flex-1">
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">${task.title}</h3>
                        <p class="text-gray-600 mb-3">${task.description || ''}</p>
                    </div>
                    <div class="flex gap-2">
                        <button class="edit-task p-2 text-blue-600 hover:bg-blue-50 rounded" data-task-id="${task.id}">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
                            </svg>
                        </button>
                        <button class="delete-task p-2 text-red-600 hover:bg-red-50 rounded" data-task-id="${task.id}">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3 6 5 6 21 6"></polyline>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="grid grid-cols-4 gap-4 mb-3">
                    <div class="flex items-center gap-2">
                        <span class="px-2 py-1 rounded text-sm border ${getPriorityColor(task.priority)}">${task.priority}</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="px-3 py-1 rounded text-sm ${getStatusColor(task.status)}">${task.status}</span>
                    </div>
                    ${task.dueDate ? `<div class="flex items-center gap-2 text-gray-600"><span class="text-sm">${new Date(task.dueDate).toLocaleDateString()}</span></div>` : '<div></div>'}
                    ${task.assignedTo ? `<div class="flex items-center gap-2 text-gray-600"><span class="text-sm">${task.assignedTo}</span></div>` : '<div></div>'}
                </div>
                <div class="text-sm text-gray-500 mb-3">Phase: <span class="font-medium text-indigo-600">${task.phase}</span></div>
                ${task.links && task.links.length > 0 ? `
                    <div class="mb-3">
                        <div class="text-sm font-medium text-gray-700 mb-2">Attached Documents:</div>
                        <div class="flex flex-wrap gap-2">
                            ${task.links.map(link => `
                                <a href="${link.url}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1 px-3 py-1 bg-blue-50 text-blue-700 rounded hover:bg-blue-100 text-sm">
                                    ${link.name}
                                </a>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
                ${task.notes ? `
                    <div class="mt-3 p-3 bg-gray-50 rounded">
                        <div class="text-sm font-medium text-gray-700 mb-1">Notes:</div>
                        <div class="text-sm text-gray-600">${task.notes}</div>
                    </div>
                ` : ''}
            `;
        }

        function generateEditForm(task) {
            const phases = ['Planning & Design', 'Data Collection', 'Analysis', 'Reporting & Dissemination', 'Stakeholder Engagement'];
            const teamMembers = ['Alexa', 'Dillon', 'Lindsey', 'Carson', 'Kyle', 'StudentWellness Team'];
            
            return `
                <div class="bg-white p-6 rounded-lg border-2 border-blue-200">
                    <input type="text" id="edit-title-${task.id}" value="${task.title || ''}" placeholder="Task Title" class="w-full p-2 mb-3 border rounded" />
                    <textarea id="edit-description-${task.id}" placeholder="Description" class="w-full p-2 mb-3 border rounded h-20">${task.description || ''}</textarea>
                    
                    <div class="grid grid-cols-2 gap-3 mb-3">
                        <div>
                            <label class="block text-sm font-medium mb-1">Phase</label>
                            <select id="edit-phase-${task.id}" class="w-full p-2 border rounded">
                                ${phases.map(phase => `<option value="${phase}" ${task.phase === phase ? 'selected' : ''}>${phase}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Priority</label>
                            <select id="edit-priority-${task.id}" class="w-full p-2 border rounded">
                                <option value="High" ${task.priority === 'High' ? 'selected' : ''}>High</option>
                                <option value="Medium" ${task.priority === 'Medium' ? 'selected' : ''}>Medium</option>
                                <option value="Low" ${task.priority === 'Low' ? 'selected' : ''}>Low</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Status</label>
                            <select id="edit-status-${task.id}" class="w-full p-2 border rounded">
                                <option value="Not Started" ${task.status === 'Not Started' ? 'selected' : ''}>Not Started</option>
                                <option value="In Progress" ${task.status === 'In Progress' ? 'selected' : ''}>In Progress</option>
                                <option value="Completed" ${task.status === 'Completed' ? 'selected' : ''}>Completed</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Due Date</label>
                            <input type="date" id="edit-dueDate-${task.id}" value="${task.dueDate || ''}" class="w-full p-2 border rounded" />
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="block text-sm font-medium mb-1">Assigned To</label>
                        <select id="edit-assignedTo-${task.id}" class="w-full p-2 border rounded">
                            <option value="">Select team member...</option>
                            ${teamMembers.map(member => `<option value="${member}" ${task.assignedTo === member ? 'selected' : ''}>${member}</option>`).join('')}
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="block text-sm font-medium mb-1">Notes</label>
                        <textarea id="edit-notes-${task.id}" placeholder="Additional notes" class="w-full p-2 border rounded h-16">${task.notes || ''}</textarea>
                    </div>
                    
                    <div class="flex gap-2">
                        <button class="save-task px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600" data-task-id="${task.id}">Save Changes</button>
                        <button class="cancel-edit px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400">Cancel</button>
                    </div>
                </div>
            `;
        }

        function attachEventListeners() {
            // Add task button
            const addBtn = document.getElementById('addTaskBtn');
            if (addBtn) {
                addBtn.onclick = () => showAddTaskForm();
            }

            // Filters
            const statusFilter = document.getElementById('statusFilter');
            if (statusFilter) {
                statusFilter.value = window.appState.statusFilter || 'all';
                statusFilter.onchange = (e) => {
                    window.appState.statusFilter = e.target.value;
                    renderApp();
                };
            }

            const phaseFilterSelect = document.getElementById('phaseFilterSelect');
            if (phaseFilterSelect) {
                phaseFilterSelect.value = window.appState.phaseFilter || 'all';
                phaseFilterSelect.onchange = (e) => {
                    window.appState.phaseFilter = e.target.value;
                    renderApp();
                };
            }

            const assigneeFilter = document.getElementById('assigneeFilter');
            if (assigneeFilter) {
                assigneeFilter.value = window.appState.assigneeFilter || 'all';
                assigneeFilter.onchange = (e) => {
                    window.appState.assigneeFilter = e.target.value;
                    renderApp();
                };
            }

            // Edit buttons
            document.querySelectorAll('.edit-task').forEach(btn => {
                btn.onclick = () => {
                    window.appState.isEditing = true;
                    window.appState.editingTaskId = btn.dataset.taskId;
                    renderApp();
                };
            });

            // Delete buttons
            document.querySelectorAll('.delete-task').forEach(btn => {
                btn.onclick = () => {
                    if (confirm('Are you sure you want to delete this task?')) {
                        window.firebaseRemove(window.firebaseRef(window.firebaseDB, `tasks/${btn.dataset.taskId}`));
                    }
                };
            });

            // Save buttons
            document.querySelectorAll('.save-task').forEach(btn => {
                btn.onclick = () => saveTask(btn.dataset.taskId);
            });

            // Cancel buttons
            document.querySelectorAll('.cancel-edit').forEach(btn => {
                btn.onclick = () => {
                    window.appState.isEditing = false;
                    window.appState.editingTaskId = null;
                    renderApp();
                };
            });
        }

        function showAddTaskForm() {
            window.appState.isEditing = true;
            const phases = ['Planning & Design', 'Data Collection', 'Analysis', 'Reporting & Dissemination', 'Stakeholder Engagement'];
            const teamMembers = ['Alexa', 'Dillon', 'Lindsey', 'Carson', 'Kyle', 'StudentWellness Team'];
            
            const formHTML = `
                <div class="bg-white p-6 rounded-lg border-2 border-blue-200 mb-4">
                    <input type="text" id="new-title" placeholder="Task Title" class="w-full p-2 mb-3 border rounded" />
                    <textarea id="new-description" placeholder="Description" class="w-full p-2 mb-3 border rounded h-20"></textarea>
                    
                    <div class="grid grid-cols-2 gap-3 mb-3">
                        <div>
                            <label class="block text-sm font-medium mb-1">Phase</label>
                            <select id="new-phase" class="w-full p-2 border rounded">
                                ${phases.map(phase => `<option value="${phase}">${phase}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Priority</label>
                            <select id="new-priority" class="w-full p-2 border rounded">
                                <option value="High">High</option>
                                <option value="Medium" selected>Medium</option>
                                <option value="Low">Low</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Status</label>
                            <select id="new-status" class="w-full p-2 border rounded">
                                <option value="Not Started" selected>Not Started</option>
                                <option value="In Progress">In Progress</option>
                                <option value="Completed">Completed</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Due Date</label>
                            <input type="date" id="new-dueDate" class="w-full p-2 border rounded" />
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="block text-sm font-medium mb-1">Assigned To</label>
                        <select id="new-assignedTo" class="w-full p-2 border rounded">
                            <option value="">Select team member...</option>
                            ${teamMembers.map(member => `<option value="${member}">${member}</option>`).join('')}
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="block text-sm font-medium mb-1">Notes</label>
                        <textarea id="new-notes" placeholder="Additional notes" class="w-full p-2 border rounded h-16"></textarea>
                    </div>
                    
                    <div class="flex gap-2">
                        <button id="save-new-task" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">Add Task</button>
                        <button id="cancel-new-task" class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400">Cancel</button>
                    </div>
                </div>
            `;
            
            document.getElementById('addTaskForm').innerHTML = formHTML;
            
            document.getElementById('save-new-task').onclick = () => saveNewTask();
            document.getElementById('cancel-new-task').onclick = () => {
                window.appState.isEditing = false;
                document.getElementById('addTaskForm').innerHTML = '';
            };
        }

        function saveNewTask() {
            const newTask = {
                title: document.getElementById('new-title').value,
                description: document.getElementById('new-description').value,
                phase: document.getElementById('new-phase').value,
                priority: document.getElementById('new-priority').value,
                status: document.getElementById('new-status').value,
                dueDate: document.getElementById('new-dueDate').value,
                assignedTo: document.getElementById('new-assignedTo').value,
                notes: document.getElementById('new-notes').value,
                links: []
            };
            
            if (newTask.title.trim()) {
                const newTaskRef = window.firebasePush(window.firebaseRef(window.firebaseDB, 'tasks'));
                window.firebaseSet(newTaskRef, newTask);
                window.appState.isEditing = false;
                document.getElementById('addTaskForm').innerHTML = '';
            }
        }

        function saveTask(taskId) {
            const updatedTask = {
                title: document.getElementById(`edit-title-${taskId}`).value,
                description: document.getElementById(`edit-description-${taskId}`).value,
                phase: document.getElementById(`edit-phase-${taskId}`).value,
                priority: document.getElementById(`edit-priority-${taskId}`).value,
                status: document.getElementById(`edit-status-${taskId}`).value,
                dueDate: document.getElementById(`edit-dueDate-${taskId}`).value,
                assignedTo: document.getElementById(`edit-assignedTo-${taskId}`).value,
                notes: document.getElementById(`edit-notes-${taskId}`).value
            };
            
            const task = window.appState.tasks.find(t => t.id === taskId);
            if (task && task.links) {
                updatedTask.links = task.links;
            } else {
                updatedTask.links = [];
            }
            
            window.firebaseUpdate(window.firebaseRef(window.firebaseDB, `tasks/${taskId}`), updatedTask);
            window.appState.isEditing = false;
            window.appState.editingTaskId = null;
        }
    </script>
</body>
</html>
