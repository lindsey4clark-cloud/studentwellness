
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Wellness Evaluation Task Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root">Loading...</div>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBNGWGQMRSHr-2-i2YN6R12Uj4XhbKBolI",
            authDomain: "wellness-student.firebaseapp.com",
            databaseURL: "https://wellness-student-default-rtdb.firebaseio.com",
            projectId: "wellness-student",
            storageBucket: "wellness-student.firebasestorage.app",
            messagingSenderId: "63000652168",
            appId: "1:63000652168:web:adceba5425f5acb4a7f23d"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const state = {
            tasks: [],
            isEditing: false,
            viewMode: 'list',
            calendarMonth: new Date().getMonth(),
            calendarYear: new Date().getFullYear(),
            editingTaskId: null,
            newTaskLinks: []
        };

        db.ref('tasks').on('value', (snapshot) => {
            const data = snapshot.val();
            const newTasks = data ? Object.keys(data).map(key => ({ id: key, ...data[key] })) : [];
            
            // Only skip render if actively typing in an input field
            const activeElement = document.activeElement;
            const isTyping = activeElement && (activeElement.tagName === 'INPUT' || activeElement.tagName === 'TEXTAREA' || activeElement.tagName === 'SELECT');
            
            if (!isTyping) {
                state.tasks = newTasks;
                render();
            } else {
                // Update state silently without re-rendering
                state.tasks = newTasks;
            }
        });

        function render() {
            const tasks = state.tasks;
            const phases = ['Planning & Design', 'Data Collection', 'Analysis', 'Reporting & Dissemination', 'Stakeholder Engagement'];
            
            const completed = tasks.length ? Math.round((tasks.filter(t => t.status === 'Completed').length / tasks.length) * 100) : 0;
            const inProgress = tasks.length ? Math.round((tasks.filter(t => t.status === 'In Progress').length / tasks.length) * 100) : 0;
            const notStarted = tasks.length ? Math.round((tasks.filter(t => t.status === 'Not Started').length / tasks.length) * 100) : 0;
            
            const filtered = tasks.filter(t => {
                return (!state.statusFilter || state.statusFilter === 'all' || t.status === state.statusFilter) && 
                       (!state.phaseFilter || state.phaseFilter === 'all' || t.phase === state.phaseFilter) && 
                       (!state.assigneeFilter || state.assigneeFilter === 'all' || t.assignedTo === state.assigneeFilter);
            });

            const phaseProgress = phases.map(phase => {
                const pts = tasks.filter(t => t.phase === phase);
                const pct = pts.length ? Math.round((pts.filter(t => t.status === 'Completed').length / pts.length) * 100) : 0;
                return `<div class="bg-white p-4 rounded shadow"><h3 class="text-sm font-semibold mb-2">${phase}</h3><div class="text-2xl font-bold text-indigo-600 mb-1">${pct}%</div><div class="w-full bg-gray-200 rounded-full h-2"><div class="bg-indigo-600 h-2 rounded-full" style="width:${pct}%"></div></div></div>`;
            }).join('');

            document.getElementById('root').innerHTML = `
                <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 p-6">
                    <div class="max-w-7xl mx-auto">
                        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <h1 class="text-3xl font-bold mb-2">Student Wellness Program Evaluation</h1>
                            <p class="text-gray-600 mb-4">Task Manager ðŸ”¥</p>
                            <div class="grid grid-cols-3 gap-4">
                                <div class="bg-green-50 p-4 rounded"><div class="flex justify-between mb-2"><span class="font-semibold">Completed</span><span class="text-2xl font-bold text-green-600">${completed}%</span></div><div class="w-full bg-gray-200 rounded-full h-3"><div class="bg-green-600 h-3 rounded-full" style="width:${completed}%"></div></div></div>
                                <div class="bg-blue-50 p-4 rounded"><div class="flex justify-between mb-2"><span class="font-semibold">In Progress</span><span class="text-2xl font-bold text-blue-600">${inProgress}%</span></div><div class="w-full bg-gray-200 rounded-full h-3"><div class="bg-blue-600 h-3 rounded-full" style="width:${inProgress}%"></div></div></div>
                                <div class="bg-gray-50 p-4 rounded"><div class="flex justify-between mb-2"><span class="font-semibold">Not Started</span><span class="text-2xl font-bold text-gray-600">${notStarted}%</span></div><div class="w-full bg-gray-200 rounded-full h-3"><div class="bg-gray-600 h-3 rounded-full" style="width:${notStarted}%"></div></div></div>
                            </div>
                        </div>
                        <div class="grid grid-cols-5 gap-3 mb-6">${phaseProgress}</div>
                        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <div class="flex gap-4 items-center mb-4 flex-wrap">
                                <button onclick="showAdd()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">+ Add Task</button>
                                <div class="flex gap-2 bg-gray-100 p-1 rounded">
                                    <button onclick="setView('list')" class="px-4 py-2 rounded ${state.viewMode === 'list' ? 'bg-white shadow' : ''}">List</button>
                                    <button onclick="setView('calendar')" class="px-4 py-2 rounded ${state.viewMode === 'calendar' ? 'bg-white shadow' : ''}">Calendar</button>
                                </div>
                                <select onchange="setFilter('status',this.value)" class="p-2 border rounded"><option value="all">All Statuses</option><option>Not Started</option><option>In Progress</option><option>Completed</option></select>
                                <select onchange="setFilter('phase',this.value)" class="p-2 border rounded"><option value="all">All Phases</option>${phases.map(p => `<option>${p}</option>`).join('')}</select>
                                <select onchange="setFilter('assignee',this.value)" class="p-2 border rounded" id="assigneeFilterSelect"><option value="all">All Team</option><option value="Alexa">Alexa</option><option value="Dillon">Dillon</option><option value="Lindsey">Lindsey</option><option value="Carson">Carson</option><option value="Kyle">Kyle</option><option value="Emily">Emily</option><option value="StudentWellness Team">StudentWellness Team</option></select>
                            </div>
                            <div id="form"></div>
                        </div>
                        ${state.viewMode === 'calendar' ? renderCalendar(filtered) : renderList(filtered)}
                    </div>
                </div>
            `;
        }

        function renderList(tasks) {
            if (!tasks.length) return '<div class="bg-white rounded shadow p-8 text-center text-gray-500">No tasks</div>';
            return '<div class="space-y-4">' + tasks.map(t => `<div class="bg-white rounded shadow-md p-6">${state.editingTaskId === t.id ? renderEdit(t) : renderCard(t)}</div>`).join('') + '</div>';
        }

        function renderCard(t) {
            const pc = { High: 'text-red-600 bg-red-50', Medium: 'text-yellow-600 bg-yellow-50', Low: 'text-green-600 bg-green-50' };
            const sc = { Completed: 'text-green-700 bg-green-100', 'In Progress': 'text-blue-700 bg-blue-100', 'Not Started': 'text-gray-700 bg-gray-100' };
            return `<div class="flex justify-between mb-3"><div class="flex-1"><h3 class="text-xl font-semibold mb-2">${t.title}</h3><p class="text-gray-600">${t.description || ''}</p></div><div class="flex gap-2"><button onclick="edit('${t.id}')" class="p-2 text-blue-600 hover:bg-blue-50 rounded">âœŽ</button><button onclick="del('${t.id}')" class="p-2 text-red-600 hover:bg-red-50 rounded">ðŸ—‘</button></div></div><div class="flex gap-4 mb-3"><span class="px-3 py-1 rounded text-sm ${pc[t.priority]}">${t.priority}</span><span class="px-3 py-1 rounded text-sm ${sc[t.status]}">${t.status}</span>${t.dueDate ? `<span class="text-sm text-gray-600">${new Date(t.dueDate).toLocaleDateString()}</span>` : ''}${t.assignedTo ? `<span class="text-sm text-gray-600">${t.assignedTo}</span>` : ''}</div><div class="text-sm text-gray-500">Phase: <span class="font-medium text-indigo-600">${t.phase}</span></div>${t.links?.length ? '<div class="mt-3"><div class="text-sm font-medium mb-2">Links:</div>' + t.links.map(l => `<a href="${l.url}" target="_blank" class="inline-block px-3 py-1 bg-blue-50 text-blue-700 rounded text-sm mr-2 mb-2 hover:bg-blue-100">${l.name}</a>`).join('') + '</div>' : ''}${t.notes ? `<div class="mt-3 p-3 bg-gray-50 rounded"><div class="text-sm font-medium mb-1">Notes:</div><div class="text-sm">${t.notes}</div></div>` : ''}`;
        }

        function renderEdit(t) {
            const phases = ['Planning & Design', 'Data Collection', 'Analysis', 'Reporting & Dissemination', 'Stakeholder Engagement'];
            const members = ['Alexa', 'Dillon', 'Lindsey', 'Carson', 'Kyle', 'Emily', 'StudentWellness Team'];
            return `<div class="border-2 border-blue-200 p-4 rounded"><input id="t" value="${t.title}" placeholder="Title" class="w-full p-2 mb-3 border rounded"><textarea id="d" class="w-full p-2 mb-3 border rounded h-20">${t.description || ''}</textarea><div class="grid grid-cols-2 gap-3 mb-3"><select id="ph" class="p-2 border rounded">${phases.map(p => `<option ${t.phase === p ? 'selected' : ''}>${p}</option>`).join('')}</select><select id="pr" class="p-2 border rounded"><option ${t.priority === 'High' ? 'selected' : ''}>High</option><option ${t.priority === 'Medium' ? 'selected' : ''}>Medium</option><option ${t.priority === 'Low' ? 'selected' : ''}>Low</option></select><select id="st" class="p-2 border rounded"><option ${t.status === 'Not Started' ? 'selected' : ''}>Not Started</option><option ${t.status === 'In Progress' ? 'selected' : ''}>In Progress</option><option ${t.status === 'Completed' ? 'selected' : ''}>Completed</option></select><input id="dd" type="date" value="${t.dueDate || ''}" class="p-2 border rounded"></div><select id="as" class="w-full p-2 border rounded mb-3"><option value="">Assign...</option>${members.map(m => `<option ${t.assignedTo === m ? 'selected' : ''}>${m}</option>`).join('')}</select><div class="mb-3"><label class="block text-sm font-medium mb-2">Links</label><div class="flex gap-2 mb-2"><input id="ln" placeholder="Name" class="flex-1 p-2 border rounded"><input id="lu" placeholder="URL" class="flex-1 p-2 border rounded"><button onclick="addL()" class="px-4 py-2 bg-blue-500 text-white rounded">Add</button></div><div id="ll">${t.links?.map(l => `<div class="flex gap-2 p-2 bg-gray-50 rounded mb-1"><a href="${l.url}" target="_blank" class="flex-1 text-blue-600">${l.name}</a><button onclick="remL(${l.id})" class="text-red-500">âœ•</button></div>`).join('') || ''}</div></div><textarea id="nt" class="w-full p-2 border rounded h-16 mb-3">${t.notes || ''}</textarea><div class="flex gap-2"><button onclick="save()" class="px-4 py-2 bg-green-500 text-white rounded">Save</button><button onclick="cancel()" class="px-4 py-2 bg-gray-300 rounded">Cancel</button></div></div>`;
        }

        function renderCalendar(tasks) {
            const m = state.calendarMonth, y = state.calendarYear;
            const mn = new Date(y, m, 1).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            const fd = new Date(y, m, 1).getDay();
            const dm = new Date(y, m + 1, 0).getDate();
            const now = new Date(), ic = m === now.getMonth() && y === now.getFullYear();
            
            const td = {};
            tasks.forEach(t => {
                if (t.dueDate) {
                    const d = new Date(t.dueDate + 'T00:00:00');
                    const k = `${d.getFullYear()}-${d.getMonth()}-${d.getDate()}`;
                    if (!td[k]) td[k] = [];
                    td[k].push(t);
                }
            });

            let cal = `<div class="bg-white rounded shadow-lg p-6"><div class="flex justify-between mb-6"><h2 class="text-2xl font-bold">${mn}</h2><div class="flex gap-2"><button onclick="navMonth(-1)" class="px-3 py-1 bg-blue-500 text-white rounded">â—€</button><button onclick="today()" class="px-3 py-1 bg-gray-200 rounded">Today</button><button onclick="navMonth(1)" class="px-3 py-1 bg-blue-500 text-white rounded">â–¶</button></div></div><div class="grid grid-cols-7 gap-2">`;
            
            ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(d => cal += `<div class="text-center font-semibold p-2 bg-gray-100">${d}</div>`);
            
            for (let i = 0; i < fd; i++) cal += '<div class="border p-2 min-h-24 bg-gray-50"></div>';
            
            for (let day = 1; day <= dm; day++) {
                const k = `${y}-${m}-${day}`;
                const dt = td[k] || [];
                const it = ic && day === now.getDate();
                const pc = { High: 'bg-red-100 border-red-400', Medium: 'bg-yellow-100 border-yellow-400', Low: 'bg-green-100 border-green-400' };
                cal += `<div class="border p-2 min-h-24 ${it ? 'bg-blue-50 border-blue-400' : 'bg-white'}"><div class="font-semibold mb-1 ${it ? 'text-blue-600' : ''}">${day}</div>${dt.map(t => `<div class="text-xs p-1 border-l-2 ${pc[t.priority] || 'bg-gray-100'} cursor-pointer mb-1" onclick="viewTask('${t.id}')"><div class="truncate font-medium">${t.title}</div>${t.assignedTo ? `<div class="text-gray-600 truncate">${t.assignedTo}</div>` : ''}</div>`).join('')}</div>`;
            }
            
            return cal + '</div></div>';
        }

        function setView(v) { state.viewMode = v; render(); }
        function setFilter(t, v) { 
            if (t === 'status') state.statusFilter = v;
            if (t === 'phase') state.phaseFilter = v;
            if (t === 'assignee') state.assigneeFilter = v;
            render(); 
        }
        function edit(id) { state.isEditing = true; state.editingTaskId = id; render(); }
        function del(id) { if (confirm('Delete?')) db.ref(`tasks/${id}`).remove(); }
        function cancel() { state.isEditing = false; state.editingTaskId = null; render(); }
        function navMonth(d) { state.calendarMonth += d; if (state.calendarMonth < 0) { state.calendarMonth = 11; state.calendarYear--; } if (state.calendarMonth > 11) { state.calendarMonth = 0; state.calendarYear++; } render(); }
        function today() { const n = new Date(); state.calendarMonth = n.getMonth(); state.calendarYear = n.getFullYear(); render(); }
        function viewTask(id) { state.viewMode = 'list'; state.isEditing = true; state.editingTaskId = id; render(); }

        function save() {
            const id = state.editingTaskId;
            const task = state.tasks.find(t => t.id === id);
            state.isEditing = false;
            state.editingTaskId = null;
            db.ref(`tasks/${id}`).set({
                title: document.getElementById('t').value,
                description: document.getElementById('d').value,
                phase: document.getElementById('ph').value,
                priority: document.getElementById('pr').value,
                status: document.getElementById('st').value,
                dueDate: document.getElementById('dd').value,
                assignedTo: document.getElementById('as').value,
                notes: document.getElementById('nt').value,
                links: task.links || []
            });
        }

        function addL() {
            const id = state.editingTaskId;
            const task = state.tasks.find(t => t.id === id);
            const n = document.getElementById('ln').value.trim();
            const u = document.getElementById('lu').value.trim();
            if (n && u) {
                const links = task.links || [];
                links.push({ id: Date.now(), name: n, url: u });
                task.links = links;
                db.ref(`tasks/${id}`).update({ links });
                document.getElementById('ln').value = '';
                document.getElementById('lu').value = '';
                document.getElementById('ll').innerHTML = links.map(l => `<div class="flex gap-2 p-2 bg-gray-50 rounded mb-1"><a href="${l.url}" target="_blank" class="flex-1 text-blue-600">${l.name}</a><button onclick="remL(${l.id})" class="text-red-500">âœ•</button></div>`).join('');
            }
        }

        function remL(linkId) {
            const id = state.editingTaskId;
            const task = state.tasks.find(t => t.id === id);
            const links = (task.links || []).filter(l => l.id !== linkId);
            task.links = links;
            db.ref(`tasks/${id}`).update({ links });
            document.getElementById('ll').innerHTML = links.map(l => `<div class="flex gap-2 p-2 bg-gray-50 rounded mb-1"><a href="${l.url}" target="_blank" class="flex-1 text-blue-600">${l.name}</a><button onclick="remL(${l.id})" class="text-red-500">âœ•</button></div>`).join('');
        }

        function showAdd() {
            state.isEditing = true;
            state.newTaskLinks = [];
            const phases = ['Planning & Design', 'Data Collection', 'Analysis', 'Reporting & Dissemination', 'Stakeholder Engagement'];
            const members = ['Alexa', 'Dillon', 'Lindsey', 'Carson', 'Kyle', 'StudentWellness Team'];
            document.getElementById('form').innerHTML = `<div class="border-2 border-blue-200 p-4 rounded mt-4"><input id="nt" placeholder="Title" class="w-full p-2 mb-3 border rounded"><textarea id="nd" class="w-full p-2 mb-3 border rounded h-20"></textarea><div class="grid grid-cols-2 gap-3 mb-3"><select id="nph" class="p-2 border rounded">${phases.map(p => `<option>${p}</option>`).join('')}</select><select id="npr" class="p-2 border rounded"><option>High</option><option selected>Medium</option><option>Low</option></select><select id="nst" class="p-2 border rounded"><option selected>Not Started</option><option>In Progress</option><option>Completed</option></select><input id="ndd" type="date" class="p-2 border rounded"></div><select id="nas" class="w-full p-2 border rounded mb-3"><option value="">Assign...</option>${members.map(m => `<option>${m}</option>`).join('')}</select><div class="mb-3"><label class="block text-sm font-medium mb-2">Links</label><div class="flex gap-2 mb-2"><input id="nln" placeholder="Name" class="flex-1 p-2 border rounded"><input id="nlu" placeholder="URL" class="flex-1 p-2 border rounded"><button onclick="addNL()" class="px-4 py-2 bg-blue-500 text-white rounded">Add</button></div><div id="nll"></div></div><textarea id="nnt" class="w-full p-2 border rounded h-16 mb-3"></textarea><div class="flex gap-2"><button onclick="saveNew()" class="px-4 py-2 bg-green-500 text-white rounded">Add</button><button onclick="cancelNew()" class="px-4 py-2 bg-gray-300 rounded">Cancel</button></div></div>`;
        }

        function addNL() {
            const n = document.getElementById('nln').value.trim();
            const u = document.getElementById('nlu').value.trim();
            if (n && u) {
                state.newTaskLinks.push({ id: Date.now(), name: n, url: u });
                document.getElementById('nln').value = '';
                document.getElementById('nlu').value = '';
                document.getElementById('nll').innerHTML = state.newTaskLinks.map(l => `<div class="flex gap-2 p-2 bg-gray-50 rounded mb-1"><a href="${l.url}" target="_blank" class="flex-1 text-blue-600">${l.name}</a><button onclick="remNL(${l.id})" class="text-red-500">âœ•</button></div>`).join('');
            }
        }

        function remNL(id) {
            state.newTaskLinks = state.newTaskLinks.filter(l => l.id !== id);
            document.getElementById('nll').innerHTML = state.newTaskLinks.map(l => `<div class="flex gap-2 p-2 bg-gray-50 rounded mb-1"><a href="${l.url}" target="_blank" class="flex-1 text-blue-600">${l.name}</a><button onclick="remNL(${l.id})" class="text-red-500">âœ•</button></div>`).join('');
        }

        function saveNew() {
            const task = {
                title: document.getElementById('nt').value,
                description: document.getElementById('nd').value,
                phase: document.getElementById('nph').value,
                priority: document.getElementById('npr').value,
                status: document.getElementById('nst').value,
                dueDate: document.getElementById('ndd').value,
                assignedTo: document.getElementById('nas').value,
                notes: document.getElementById('nnt').value,
                links: state.newTaskLinks
            };
            if (task.title.trim()) {
                state.isEditing = false;
                state.newTaskLinks = [];
                document.getElementById('form').innerHTML = '';
                db.ref('tasks').push(task);
            }
        }

        function cancelNew() {
            state.isEditing = false;
            document.getElementById('form').innerHTML = '';
        }
    </script>
</body>
</html>


